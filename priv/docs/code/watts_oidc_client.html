<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Module watts_oidc_client</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module watts_oidc_client</h1>
<ul class="index"><li><a href="#description">Description</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>the OpenID Connect client implementation for WaTTS.

<p><b>Behaviours:</b> <a href="oidcc_client.html"><tt>oidcc_client</tt></a>.</p>
<p><b>See also:</b> <a href="watts_http_api.html">watts_http_api</a>.</p>

<h2><a name="description">Description</a></h2>the OpenID Connect client implementation for WaTTS.
  This modules handles the login trys at the web inteface only, the
  logins using the dropdown at the javascript ui, not the logins by
  access tokens at the api.
<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#bin_error_msg-2">bin_error_msg/2*</a></td><td>conver an error and the details into a binary error message.</td></tr>
<tr><td valign="top"><a href="#error_msg-2">error_msg/2*</a></td><td>conver an error and the details into a string error message.</td></tr>
<tr><td valign="top"><a href="#get_cookie_session_type-1">get_cookie_session_type/1*</a></td><td>get the session and its type from cookie data.</td></tr>
<tr><td valign="top"><a href="#get_return_url-2">get_return_url/2*</a></td><td>get the urls from the rsp and retrun the on that fits the result.</td></tr>
<tr><td valign="top"><a href="#get_session_type-1">get_session_type/1*</a></td><td>get the session and its type from a cowboy request.</td></tr>
<tr><td valign="top"><a href="#handle_failed_for_session-5">handle_failed_for_session/5*</a></td><td>helper function to generate a redirect depending of the requests origin.</td></tr>
<tr><td valign="top"><a href="#login_failed-2">login_failed/2</a></td><td>unused function to be compliant with behaviour.</td></tr>
<tr><td valign="top"><a href="#login_failed-3">login_failed/3</a></td><td>handles a failed login of a user at the web interface (java script ui).</td></tr>
<tr><td valign="top"><a href="#login_succeeded-1">login_succeeded/1</a></td><td>unused function to be compliant with behaviour.</td></tr>
<tr><td valign="top"><a href="#login_succeeded-2">login_succeeded/2</a></td><td>handle the successful login of a user at an oidc provider.</td></tr>
<tr><td valign="top"><a href="#redirect_back-3">redirect_back/3*</a></td><td>redirect back depending on the result passed in.</td></tr>
<tr><td valign="top"><a href="#redirect_error-2">redirect_error/2*</a></td><td>redirect back to the main site with an error session to display.</td></tr>
<tr><td valign="top"><a href="#redirect_set_cookie-2">redirect_set_cookie/2*</a></td><td>redirect to the main site and set cookie depending on the session.</td></tr>
<tr><td valign="top"><a href="#return_session_type-1">return_session_type/1*</a></td><td>return the session and its type might also be undefined.</td></tr>
<tr><td valign="top"><a href="#set_cookie-2">set_cookie/2*</a></td><td>set the cookie for a given session or clear it.</td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="bin_error_msg-2">bin_error_msg/2 *</a></h3>
<div class="spec">
<p><tt>bin_error_msg(Reason::any(), Details::any()) -&gt; binary()</tt><br></p>
</div><p>conver an error and the details into a binary error message</p>

<h3 class="function"><a name="error_msg-2">error_msg/2 *</a></h3>
<div class="spec">
<p><tt>error_msg(Reason::any(), Details::any()) -&gt; string()</tt><br></p>
</div><p>conver an error and the details into a string error message</p>

<h3 class="function"><a name="get_cookie_session_type-1">get_cookie_session_type/1 *</a></h3>
<div class="spec">
<p><tt>get_cookie_session_type(Other::any()) -&gt; {atom() | tuple(), undefined | pid()}</tt><br></p>
</div><p>get the session and its type from cookie data</p>

<h3 class="function"><a name="get_return_url-2">get_return_url/2 *</a></h3>
<div class="spec">
<p><tt>get_return_url(X1::{ok | error, #{}}, Rsp::<a href="watts_rsp.html#type-rsp">watts_rsp:rsp()</a>) -&gt; binary()</tt><br></p>
</div><p>get the urls from the rsp and retrun the on that fits the result.</p>

<h3 class="function"><a name="get_session_type-1">get_session_type/1 *</a></h3>
<div class="spec">
<p><tt>get_session_type(X1::#{}) -&gt; {atom() | tuple(), undefined | pid()}</tt><br></p>
</div><p>get the session and its type from a cowboy request</p>

<h3 class="function"><a name="handle_failed_for_session-5">handle_failed_for_session/5 *</a></h3>
<div class="spec">
<p><tt>handle_failed_for_session(SessionType::any(), SessPid::pid(), EnvMap::#{}, Reason::atom(), Details::any()) -&gt; {ok, [tuple()]}</tt><br></p>
</div><p>helper function to generate a redirect depending of the requests origin.</p>

<h3 class="function"><a name="login_failed-2">login_failed/2</a></h3>
<div class="spec">
<p><tt>login_failed(Reason::any(), Details::any()) -&gt; {ok, [tuple()]}</tt><br></p>
</div><p>unused function to be compliant with behaviour</p>

<h3 class="function"><a name="login_failed-3">login_failed/3</a></h3>
<div class="spec">
<p><tt>login_failed(Reason::atom(), Details::any(), EnvironmentMap::#{}) -&gt; {ok, [tuple()]}</tt><br></p>
</div><p>handles a failed login of a user at the web interface (java script ui).</p>
<p><b>See also:</b> <a href="#login_succeeded-2">login_succeeded/2</a>.</p>

<h3 class="function"><a name="login_succeeded-1">login_succeeded/1</a></h3>
<div class="spec">
<p><tt>login_succeeded(TokenMap::any()) -&gt; {ok, [tuple()]}</tt><br></p>
</div><p>unused function to be compliant with behaviour</p>

<h3 class="function"><a name="login_succeeded-2">login_succeeded/2</a></h3>
<div class="spec">
<p><tt>login_succeeded(TokenMap::#{}, EnvironmentMap::#{}) -&gt; {ok, [tuple()]}</tt><br></p>
</div><p>handle the successful login of a user at an oidc provider.
  This only handles logins via the java script web interface,
  logins at the api using access tokens are handled directly at the api.
  This basically calls the watts:login_with_oidcc function and handles
  the result.
 </p>
<p><b>See also:</b> <a href="watts_http_api.html">watts_http_api</a>, <a href="watts.html#login_with_oidcc-2">watts:login_with_oidcc/2</a>.</p>

<h3 class="function"><a name="redirect_back-3">redirect_back/3 *</a></h3>
<div class="spec">
<p><tt>redirect_back(Result::{ok | error, #{}}, Session::pid(), EnvMap::#{}) -&gt; {ok, [tuple()]}</tt><br></p>
</div><p>redirect back depending on the result passed in</p>

<h3 class="function"><a name="redirect_error-2">redirect_error/2 *</a></h3>
<div class="spec">
<p><tt>redirect_error(ErrorMsg::binary(), EnvMap::#{}) -&gt; {ok, [tuple()]}</tt><br></p>
</div><p>redirect back to the main site with an error session to display</p>

<h3 class="function"><a name="redirect_set_cookie-2">redirect_set_cookie/2 *</a></h3>
<div class="spec">
<p><tt>redirect_set_cookie(Session::pid(), EnvMap::#{}) -&gt; {ok, [tuple()]}</tt><br></p>
</div><p>redirect to the main site and set cookie depending on the session.</p>

<h3 class="function"><a name="return_session_type-1">return_session_type/1 *</a></h3>
<div class="spec">
<p><tt>return_session_type(X1::any()) -&gt; {atom() | tuple(), undefined | pid()}</tt><br></p>
</div><p>return the session and its type might also be undefined</p>

<h3 class="function"><a name="set_cookie-2">set_cookie/2 *</a></h3>
<div class="spec">
<p><tt>set_cookie(Session::pid() | undefined, EnvMap::#{}) -&gt; tuple()</tt><br></p>
</div><p>set the cookie for a given session or clear it.</p>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc</i></p>
</body>
</html>
