<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Module watts_userinfo</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module watts_userinfo</h1>
<ul class="index"><li><a href="#description">Description</a></li><li><a href="#types">Data Types</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>This module implements the userinfo data structure and the functions
  to access it.


<h2><a name="description">Description</a></h2>This module implements the userinfo data structure and the functions
  to access it
<h2><a name="types">Data Types</a></h2>

<h3 class="typedecl"><a name="type-additional_login">additional_login()</a></h3>
<p><tt>additional_login() = {{ServiceId::binary(), IssuerId::binary()}, UserInfo::<a href="#type-userinfo">userinfo()</a>}</tt></p>


<h3 class="typedecl"><a name="type-userinfo">userinfo()</a></h3>
<p><tt>userinfo() = #user_info{issuer = undefined | binary(), subject = undefined | binary(), id_token = #{}, id_info = #{}, access_token = #{}, plugin_info = #{}, token_info = #{}, additional_logins = [<a href="#type-additional_login">additional_login()</a>], scope = #{}}</tt></p>


<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#access_token-1">access_token/1*</a></td><td>return the access token, if present.</td></tr>
<tr><td valign="top"><a href="#add_additional_login-4">add_additional_login/4</a></td><td>add an additional login.</td></tr>
<tr><td valign="top"><a href="#clear_additional_logins-2">clear_additional_logins/2</a></td><td>delete all additional logins for a service.</td></tr>
<tr><td valign="top"><a href="#display_name-1">display_name/1*</a></td><td>generate the display name.</td></tr>
<tr><td valign="top"><a href="#has_additional_login-3">has_additional_login/3</a></td><td>check if an additional login for the service and issuer exists.</td></tr>
<tr><td valign="top"><a href="#logged_in-1">logged_in/1*</a></td><td>return if the user is logged in.</td></tr>
<tr><td valign="top"><a href="#maybe_to_atom-1">maybe_to_atom/1*</a></td><td>convert a binary to atom, if the atom exists.</td></tr>
<tr><td valign="top"><a href="#new-0">new/0</a></td><td>create a new userinfo structure (record).</td></tr>
<tr><td valign="top"><a href="#return-2">return/2</a></td><td>generic function to return needed information.</td></tr>
<tr><td valign="top"><a href="#set_scope_if_empty-1">set_scope_if_empty/1*</a></td><td>set an empty scope if no scope is set.</td></tr>
<tr><td valign="top"><a href="#update_access_token-2">update_access_token/2</a></td><td>update the access token in the userinfo, if it is valid.</td></tr>
<tr><td valign="top"><a href="#update_id_info-2">update_id_info/2</a></td><td>update subject from the Userinfo Endpoint, if matching the userinfo.</td></tr>
<tr><td valign="top"><a href="#update_id_token-2">update_id_token/2</a></td><td>claims and iss/sub coming from an Id Token.</td></tr>
<tr><td valign="top"><a href="#update_iss_sub-3">update_iss_sub/3</a></td><td>update issuer and subject of the userinfo, if valid.</td></tr>
<tr><td valign="top"><a href="#update_plugin_info-1">update_plugin_info/1*</a></td><td>update the prepared information for the plugin about the user.</td></tr>
<tr><td valign="top"><a href="#update_scope-2">update_scope/2*</a></td><td>set the scope in the userinfo.</td></tr>
<tr><td valign="top"><a href="#update_token_info-2">update_token_info/2</a></td><td>update subject from the Tokeninfo Endpoint and set scopes.</td></tr>
<tr><td valign="top"><a href="#update_with_token-2">update_with_token/2</a></td><td>update the structure with the information from the Token.</td></tr>
<tr><td valign="top"><a href="#userid-1">userid/1*</a></td><td>generate the userid.</td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="access_token-1">access_token/1 *</a></h3>
<div class="spec">
<p><tt>access_token(UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; {ok, AccessToken::binary} | {error, Reason::atom()}</tt><br></p>
</div><p>return the access token, if present</p>

<h3 class="function"><a name="add_additional_login-4">add_additional_login/4</a></h3>
<div class="spec">
<p><tt>add_additional_login(ServiceId::binary(), IssuerId::binary(), Token::#{}, UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; UpdatedInfo::<a href="#type-userinfo">userinfo()</a></tt><br></p>
</div><p>add an additional login</p>

<h3 class="function"><a name="clear_additional_logins-2">clear_additional_logins/2</a></h3>
<div class="spec">
<p><tt>clear_additional_logins(ServiceId::binary(), UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; UpdatedInfo::<a href="#type-userinfo">userinfo()</a></tt><br></p>
</div><p>delete all additional logins for a service</p>

<h3 class="function"><a name="display_name-1">display_name/1 *</a></h3>
<div class="spec">
<p><tt>display_name(UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; {ok, Name::binary} | {error, Reason::atom()}</tt><br></p>
</div><p>generate the display name</p>

<h3 class="function"><a name="has_additional_login-3">has_additional_login/3</a></h3>
<div class="spec">
<p><tt>has_additional_login(ServiceId::binary(), IssuerId::binary(), UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; boolean()</tt><br></p>
</div><p>check if an additional login for the service and issuer exists.</p>

<h3 class="function"><a name="logged_in-1">logged_in/1 *</a></h3>
<div class="spec">
<p><tt>logged_in(UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; boolean()</tt><br></p>
</div><p>return if the user is logged in</p>

<h3 class="function"><a name="maybe_to_atom-1">maybe_to_atom/1 *</a></h3>
<div class="spec">
<p><tt>maybe_to_atom(Binary::binary()) -&gt; atom() | binary()</tt><br></p>
</div><p>convert a binary to atom, if the atom exists</p>

<h3 class="function"><a name="new-0">new/0</a></h3>
<div class="spec">
<p><tt>new() -&gt; {ok, <a href="#type-userinfo">userinfo()</a>}</tt><br></p>
</div><p>create a new userinfo structure (record).</p>

<h3 class="function"><a name="return-2">return/2</a></h3>
<div class="spec">
<p><tt>return(Key::atom() | {key, Key::binary()} | {additional_logins, ServiceId::binary(), WithAccessToken::boolean()}, UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; {ok, Data::any()} | {ok, Iss::binary(), Sub::binary} | boolean() | {error, Reason::atom()}</tt><br></p>
</div><p>generic function to return needed information.
  The returned values are:
  <ul>
  <il> {key, Key}: get a certain key from the plugin info, used for service
  authz </il>
  <il> plugin_info: get the plugin info map </il>
  <il> additional_logins: get the additional logins </il>
  <il> issuer_subject: get the Issuer and Subject  </il>
  <il> issuer: get the issuer used to login </il>
  <il> subject: get the subject of the user </il>
  <il> id: return the WaTTS userid </il>
  <il> access_token: return the access token </il>
  <il> display_name: return the display name of the user </il>
  <il> logged_in: return if the user is logged in </il>
  </ul></p>

<h3 class="function"><a name="set_scope_if_empty-1">set_scope_if_empty/1 *</a></h3>
<div class="spec">
<p><tt>set_scope_if_empty(UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; UpdatedInfo::<a href="#type-userinfo">userinfo()</a></tt><br></p>
</div><p>set an empty scope if no scope is set</p>

<h3 class="function"><a name="update_access_token-2">update_access_token/2</a></h3>
<div class="spec">
<p><tt>update_access_token(TokenMap::#{}, UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; {ok, UpdatedInfo::<a href="#type-userinfo">userinfo()</a>} | {error, Reason::atom()}</tt><br></p>
</div><p>update the access token in the userinfo, if it is valid.</p>

<h3 class="function"><a name="update_id_info-2">update_id_info/2</a></h3>
<div class="spec">
<p><tt>update_id_info(IdInfo::#{}, UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; {ok, UpdatedInfo::<a href="#type-userinfo">userinfo()</a>} | {error, Reason::atom()}</tt><br></p>
</div><p>update subject from the Userinfo Endpoint, if matching the userinfo.</p>

<h3 class="function"><a name="update_id_token-2">update_id_token/2</a></h3>
<div class="spec">
<p><tt>update_id_token(IdToken::#{}, Info::<a href="#type-userinfo">userinfo()</a>) -&gt; {ok, <a href="#type-userinfo">userinfo()</a>} | {error, not_match}</tt><br></p>
</div><p>claims and iss/sub coming from an Id Token</p>

<h3 class="function"><a name="update_iss_sub-3">update_iss_sub/3</a></h3>
<div class="spec">
<p><tt>update_iss_sub(Issuer::binary() | undefined, Subject::binary() | undefined, UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; {ok, UpdatedInfo::<a href="#type-userinfo">userinfo()</a>} | {error, Reason::atom()}</tt><br></p>
</div><p>update issuer and subject of the userinfo, if valid.</p>

<h3 class="function"><a name="update_plugin_info-1">update_plugin_info/1 *</a></h3>
<div class="spec">
<p><tt>update_plugin_info(UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; UpdatedInfo::<a href="#type-userinfo">userinfo()</a></tt><br></p>
</div><p>update the prepared information for the plugin about the user.</p>

<h3 class="function"><a name="update_scope-2">update_scope/2 *</a></h3>
<div class="spec">
<p><tt>update_scope(Scope::#{}, UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; {ok, UpdatedInfo::<a href="#type-userinfo">userinfo()</a>}</tt><br></p>
</div><p>set the scope in the userinfo</p>

<h3 class="function"><a name="update_token_info-2">update_token_info/2</a></h3>
<div class="spec">
<p><tt>update_token_info(TokenInfo::#{}, UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; {ok, UpdatedInfo::<a href="#type-userinfo">userinfo()</a>} | {error, Reason::atom()}</tt><br></p>
</div><p>update subject from the Tokeninfo Endpoint and set scopes.</p>

<h3 class="function"><a name="update_with_token-2">update_with_token/2</a></h3>
<div class="spec">
<p><tt>update_with_token(Token::#{}, UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; {ok, UpdatedInfo::<a href="#type-userinfo">userinfo()</a>}</tt><br></p>
</div><p>update the structure with the information from the Token</p>

<h3 class="function"><a name="userid-1">userid/1 *</a></h3>
<div class="spec">
<p><tt>userid(UserInfo::<a href="#type-userinfo">userinfo()</a>) -&gt; {ok, Id::binary} | {error, Reason::atom()}</tt><br></p>
</div><p>generate the userid</p>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc</i></p>
</body>
</html>
