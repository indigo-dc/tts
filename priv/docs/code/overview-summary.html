<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>WaTTS the Token Translation Service</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<h1>WaTTS the Token Translation Service</h1>
<p>Copyright Â© 2015-2017 SCC/KIT</p>
<p><b>Authors:</b> Bas Wegh.</p>

<h3><a name="Introduction">Introduction</a></h3><p>
WaTTS is an application to 'translate' OpenID Connect (oidc) information into
information specific to a use case. One Example is the translation from oidc to an x509
certificate.</p>

<p>The general architecture of the application is split into two parts, the WaTTS server, which
this documentation is about. The other part is the WaTTS client ui, a Java script single page
application that uses the rest interface of the WaTTS server.</p>

The translation from the OpenID Connect information another service specific representation is
done in two steps:
<ul>
<li> First all possible information about a user are gathered</li>
<li>Second the information is passed to a so called 'plugin'. The plugin does the actual translation. </li>
</ul><p>
The result of this translation is then presented to the user.</p>

WaTTS is started using the OTP application behaviour, the module implementing it is
<a href="watts_app.html"><code>watts_app</code></a>.
The supervision tree looks as follows. The list is in order of execution, the ordering is
depth first, so 1.2 gets started before 2. List entries without a number are dynamicly
created at run time and none at the loading phase.
<ol>
<li> <a href="watts_sup.html"><code>watts_sup</code></a> (supervisor, registered) </li>
<ol>
<li> <a href="watts_sessions_sup.html"><code>watts_sessions_sup</code></a> (supervisor, registered) ensures that all sub processes keep running </li>
     <ol>
     <li> <a href="watts_session_sup.html"><code>watts_session_sup</code></a> (supervisor, registered, simple_one_for_one) will handle dynamically created sessions. </li>
          <ul>
          <li> <a href="watts_session.html"><code>watts_session</code></a> (worker, dynamic) a dynamic session at the rest/web interface. </li>
          </ul>
     <li> <a href="watts_session_mgr.html"><code>watts_session_mgr</code></a> (worker, registered) a process to ensure that creation of sessions are serialized so no race conditions can occur. </li>
     </ol>
<li> <a href="watts_rsp_keys_sup.html"><code>watts_rsp_keys_sup</code></a> (supervisor, registered, simple_one_for_one) the supervisor for the rsp key fetcher </li>
     <ul>
     <li> <a href="watts_rsp_keys.html"><code>watts_rsp_keys</code></a> (worker, dynamic) one process per RSP to keep the public-key(s) of the RSP up to date. </li>
     </ul>
<li> <a href="watts_plugin_sup.html"><code>watts_plugin_sup</code></a> (supervisor, registered, simple_one_for_one) dynamically creating processes to run plugins. </li>
     <ul>
     <li> <a href="watts_plugin_runner.html"><code>watts_plugin_runner</code></a> (worker, dynamic) one process per plugin execution, starting the plugin and validating the result. </li>
     </ul>
<li> <a href="watts_plugin.html"><code>watts_plugin</code></a> (worker, registered) a generic interface to plugin related information retrieval and actions. </li>
<li> <a href="watts_ets.html"><code>watts_ets</code></a> (worker, registered) the ets database process </li>
<li> <a href="watts_persistent_sqlite.html"><code>watts_persistent_sqlite</code></a> (worker, registered) the sqlite database driver </li>
<li> <a href="watts_temp_cred_sup.html"><code>watts_temp_cred_sup</code></a> (supervisor, registered, simple_one_for_one) handling very short living credential data processes. </li>
     <ul>
     <li> <a href="watts_temp_cred_data.html"><code>watts_temp_cred_data</code></a> (worker, dynamic) keeping track of the processes holding the translation generated by the plugin. </li>
     </ul>
<li> <a href="watts_temp_cred.html"><code>watts_temp_cred</code></a> (worker, registered) Holds one translation, stops itself after either 10 seconds (configurable) or after once the data has been read, what ever happens first. </li>
<li> <a href="watts_init.html"><code>watts_init</code></a> (worker) The configuration of the system. </li>
</ol>
</ol>


<p>The server is configured after all modules (code) is loaded by the module.
Have a look at <a href="watts_init.html"><code>watts_init</code></a> regarding the initialization phase.</p>


WaTTS uses different other Erlang/OTP application to perform the needed functionality, the important ones are:
<ul>
        <li> <a href="https://github.com/indigo-dc/oidcc">oidcc</a>: Used to keep track of the OpenID Connect provider and validate incomming token.</li>
        <li> <a href="https://github.com/uwiger/jobs">jobs</a>: Used to create queues per service, when needed, not to exceed the limit in paralellism.</li>
        <li> <a href="https://github.com/basho/lager">lager</a>: Used for logging.</li>
        <li> <a href="https://github.com/ninenines/cowboy">cowboy</a>: The internal webserver.</li>
        <li> <a href="https://github.com/basho/eleveldb">eleveldb</a>: The fast leveldb database.</li>
        <li> <a href="https://github.com/mmzeeman/esqlite">esqlite</a>: Sqlite3 database.</li>
        <li> <a href="https://github.com/saleyn/erlexec">erlexec</a>: Used to execute the plugins in a controlled environment.</li>
</ul>
The complete list can be found in the file rebar.conf, section deps.

<hr>
<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc</i></p>
</body>
</html>
