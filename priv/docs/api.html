
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>REST Api Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="service_ref_card.html" />
    
    
    <link rel="prev" href="developer.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="user.html">
            
                <a href="user.html">
            
                    
                    User Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="admin.html">
            
                <a href="admin.html">
            
                    
                    Deployment And Administration Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="config.html">
            
                <a href="config.html">
            
                    
                    Configuration Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="developer.html">
            
                <a href="developer.html">
            
                    
                    Developer Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6" data-path="api.html">
            
                <a href="api.html">
            
                    
                    REST Api
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="service_ref_card.html">
            
                <a href="service_ref_card.html">
            
                    
                    WaTTS - Service Reference Card
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >REST Api</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="watts---rest-api">WaTTS - REST Api</h1>
<p>This documentation is for developers. If you want to use WaTTS as a command line application, please have a look at <a href="https://github.com/indigo-dc/wattson" target="_blank">wattson</a>.</p>
<p>WaTTS offers a REST interface to perform all the actions possible via the web-interface.
Actually the web interface uses the REST API itself.</p>
<p>The WaTTS API interface is versioned, the version is part of the path. WaTTS supports the versions
<code>v1</code> and <code>v2</code>. This document will describe the protocol version <code>v2</code>. The protocol <code>v1</code> is
deprecated and should only be used by legacy applications that need the same results when used with <a href="GLOSSARY.html#tts" class="glossary-term" title="shortage for Token Translation Service">TTS</a> v0.4.</p>
<h2 id="list-provider">List Provider</h2>
<p>Retrieving the list of supported OpenId Connect provider is done by
performing a GET request for the <code>/api/v2/oidcp</code> path.</p>
<pre><code>GET /api/v2/oidcp HTTP/1.1
Host: watts.example.com
User-Agent: curl/7.47.0
Accept: */*
</code></pre><p>and the reply body is similar to (with line breaking for nicer display):</p>
<pre><code>{
  &quot;openid_provider_list&quot;: [
    {
      &quot;desc&quot;: &quot;INDIGO Datacloud Identity and Access Management (IAM)&quot;,
      &quot;id&quot;: &quot;iam&quot;,
      &quot;issuer&quot;: &quot;https://iam-test.indigo-datacloud.eu/&quot;,
      &quot;ready&quot;: true
    }
  ]
}
</code></pre><p>The response is a <code>json</code> object, and includes one key <code>openid_provider_list</code> which has
the list of OpenId Providers as a value.  Each <em>Object</em> in the list is one OpenId
Provider, the <code>id</code> is the internal id for that OpenId Provider in the WaTTS, the
<code>issuer</code> is the official issuer returned by the provider. A readable description is
in the <code>desc</code> field and <code>ready</code> indicates whether the provider is ready to be used.</p>
<h2 id="list-services">List Services</h2>
<p>To get the list of services for a user, a GET request against the <code>/api/v2/&lt;provider id&gt;/service</code>
path is performed. Replace <code>&lt;provider id&gt;</code> with the id of the provider, see &apos;ListProvider&apos;.
Authorization is needed for this request. Please refer to <code>Authorization Header</code> for more details.</p>
<p>An example request is:</p>
<pre><code>GET /api/v2/iam/service HTTP/1.1
Host: localhost
Accept: */*
Authorization: Bearer ya29.[...]MUchM
</code></pre><p>And the response is similar to:</p>
<pre><code>{
  &quot;service_list&quot;: [
    {
      &quot;authorized&quot;: true,
      &quot;authz_tooltip&quot;: &quot;Your authorisation is insufficient for this service. This may be due to missing group membership or due to a too low Level of Assurance (LoA) (Yes, we already support that kind of stuff ;D)&quot;,
      &quot;cred_count&quot;: 0,
      &quot;cred_limit&quot;: 1,
      &quot;description&quot;: &quot;Simple Info Service&quot;,
      &quot;enabled&quot;: true,
      &quot;id&quot;: &quot;info&quot;,
      &quot;limit_reached&quot;: false,
      &quot;pass_access_token&quot;: false,
      &quot;params&quot;: [
        []
      ]
    }
  ]
}
</code></pre><p>It is a <code>json</code> object with one key, <code>service_list</code>, which holds the list of services as value.
Each entry is a service object, described by its fields.
Important for requesting a <a href="GLOSSARY.html#credential" class="glossary-term" title="Any kind of information used to gain access to a service, such as e.g.
username/password for ssh">credential</a> is the <code>id</code>.</p>
<ul>
<li><em>authorized</em>: whether the user is allowed to use this service</li>
<li><em>authz_tooltip</em>: information on how the user might get the authorization</li>
<li><em>cred_count</em>: the number of credentials for this service</li>
<li><em>cred_limit</em>: how many credentials are allowed, &apos;-1&apos; means unlimited</li>
<li><em>description</em>: a textual description of the service</li>
<li><em>enabled</em>: whether this service is actually enabled</li>
<li><em>id</em>: the id of the service, used to perform requests</li>
<li><em>limit_reached</em>: whether the <a href="GLOSSARY.html#credential" class="glossary-term" title="Any kind of information used to gain access to a service, such as e.g.
username/password for ssh">credential</a> limit is reached</li>
<li><em>pass_access_token</em>: whether the access token of the user is made available to the service</li>
<li><em>params</em>: parameter sets, allowed to pass parameter to requests</li>
</ul>
<h2 id="list-credentials">List Credentials</h2>
<p>Retrieving the list of credentials currently owned by the user is done by performing a
GET request at the <code>/api/v2/&lt;provider id&gt;/credential</code> path.
Authorization is needed for this request, please refer to <code>Authorization Header</code> for details.</p>
<p>An example request is:</p>
<pre><code>GET /api/v2/iam/credential HTTP/1.1
Host: localhost
Accept: */*
Authorization: Bearer ya29.[...]MUchM
</code></pre><p>The corresponding response might be:</p>
<pre><code>{
  &quot;credential_list&quot;: [
    {
      &quot;cred_id&quot;: &quot;ab23df59-34fb-4394-a109-76cf46beaa66&quot;,
      &quot;ctime&quot;: &quot;Mon, 30 Jan 2017 14:12:21 GMT&quot;,
      &quot;interface&quot;: &quot;Web App&quot;,
      &quot;service_id&quot;: &quot;info&quot;
    }
  ]
}
</code></pre><p>The response consists of a <code>json</code> object with one key, <code>credential_list</code>. Its
value is the list of credentials, where each element is again a <code>json</code> object.  For
revoking a <a href="GLOSSARY.html#credential" class="glossary-term" title="Any kind of information used to gain access to a service, such as e.g.
username/password for ssh">credential</a>, only the id of the <a href="GLOSSARY.html#credential" class="glossary-term" title="Any kind of information used to gain access to a service, such as e.g.
username/password for ssh">credential</a>, <code>cred_id</code>,  is needed.</p>
<ul>
<li><em>cred_id</em>: the id of the <a href="GLOSSARY.html#credential" class="glossary-term" title="Any kind of information used to gain access to a service, such as e.g.
username/password for ssh">credential</a></li>
<li><em>ctime</em>: the creation time</li>
<li><em>interface</em>: which interface was used, either &apos;Web App&apos; or &apos;REST&apos;</li>
<li><em>service_id</em>: the id of the service it was issued for</li>
</ul>
<h2 id="request-credential">Request Credential</h2>
<p>The creation of the <a href="GLOSSARY.html#credential" class="glossary-term" title="Any kind of information used to gain access to a service, such as e.g.
username/password for ssh">credential</a> is triggered by a POST request to
<code>/api/v2/&lt;provider id&gt;/credential</code>, with the <code>service_id</code> as value in a <code>json</code> object.
Authorization is needed for this request, please refer to the <code>Authorization Header</code> for details.
It is important to include the <em>Content-Type</em> header with the value <code>application/json</code>, else
the request will fail with a <em>BAD REQUEST</em>.</p>
<h3 id="basic-request">Basic Request</h3>
<p>A basic request is a just a simple post of the service id with no parameter.
The post data is then simple <code>json</code> object of the form <code>{&quot;service_id&quot;:&quot;&lt;id of service&gt;&quot;}</code>.</p>
<p>A service might not support a basic request. The basic request is supported if one
of the following is true:</p>
<ul>
<li>the <code>params</code> value of the service is an empty list</li>
<li>one of the lists in <code>params</code> is an empty list</li>
<li>one of the lists in <code>params</code> contains only entries with <code>mandatory</code> set as <code>false</code></li>
</ul>
<p>An example would be:</p>
<pre><code>POST /api/v2/iam/credential HTTP/1.1
Host: localhost
Accept: */*
Authorization: Bearer ya29.[...]MUchM
Content-Type: application/json
Content-Length: 24

{&quot;service_id&quot;:&quot;info&quot;}
</code></pre><h3 id="advanced-request">Advanced Request</h3>
<p>An advanced request is a request that adds <em>paramater</em> to a request. Basically it is just
extending the <code>json</code> object of the basic request.
The important thing to note is that the keys need to be the same as specified by the
service.</p>
<p>Services that support parameter have a list of parameter sets given at the <code>params</code> key:</p>
<pre><code>{
  &quot;service_list&quot;: [
    {
      &quot;id&quot;: &quot;with_params&quot;,
      ....
      &quot;params&quot;: [
        [
            [
             { &quot;key&quot;:&quot;param_key&quot;,
               &quot;name&quot;:&quot;Name of Parameter&quot;,
               &quot;description&quot;:&quot;a long description of the parameter&quot;,
               &quot;type&quot;:&quot;textarea&quot;,
               &quot;mandatory&quot;:true}
           ],
           []
       ]
      ]
    }
  ]
}
</code></pre><p>Each parameter set is a list of parameters. A request has to satisfy one set,
meaning to provide at least all mandatory fields of that set. The example above
has two sets, one empty set and one set with one mandatory parameter <code>param_key</code>.</p>
<p>The meaning of the parameter depends on the service, and should be explained in the description.</p>
<p>To pass parameter to the request, an additional <em>key value</em> pair is added to the
<code>json</code> object, the <em>key</em> being <code>params</code> and its <em>value</em> is an additional <code>json</code> object where
each key is the value of the <code>key value</code> of the parameter entry in the set.
In the example below it would be <code>param_key</code>.</p>
<p>The advanced post body for this service might look like:</p>
<pre><code>{ &quot;service_id&quot;:&quot;with_params&quot;,
  &quot;params&quot;: {
              &quot;param_key&quot;:&quot;my passed parameter value&quot;
            }
}
</code></pre><h3 id="credential-response">Credential Response</h3>
<p>The response of WaTTS is a redirection:</p>
<pre><code>HTTP/1.1 303 See Other
content-length: 0
content-type: application/json
location: /api/v2/iam/credential_data/rwwwNYX-LaBL0dvZ7wq44g
</code></pre><p>This is a redirection to the location of the actual <a href="GLOSSARY.html#credential" class="glossary-term" title="Any kind of information used to gain access to a service, such as e.g.
username/password for ssh">credential</a> data.
Following the redirection, the <a href="GLOSSARY.html#credential" class="glossary-term" title="Any kind of information used to gain access to a service, such as e.g.
username/password for ssh">credential</a> data are returned by WaTTS:</p>
<pre><code>GET /api/v2/iam/credential_data/rwwwNYX-LaBL0dvZ7wq44g HTTP/1.1
Host: localhost
Accept: */*
</code></pre><p>And the <a href="GLOSSARY.html#credential" class="glossary-term" title="Any kind of information used to gain access to a service, such as e.g.
username/password for ssh">credential</a> is:</p>
<pre><code>HTTP/1.1 200 OK
content-type: application/json

{
  &quot;credential&quot;: {
    &quot;entries&quot;: [
      {
        &quot;name&quot;: &quot;WaTTS version&quot;,
        &quot;type&quot;: &quot;text&quot;,
        &quot;value&quot;: &quot;1.0.0&quot;
      },
      {
        &quot;name&quot;: &quot;WaTTS userid&quot;,
        &quot;type&quot;: &quot;text&quot;,
        &quot;value&quot;: &quot;eyJpZXIiYiJ9&quot;
      },
      {
        &quot;name&quot;: &quot;WaTTS userid (decoded)&quot;,
        &quot;type&quot;: &quot;text&quot;,
        &quot;value&quot;: &quot;{\&quot;issuer\&quot;:\&quot;https://provider&quot;,\&quot;subject\&quot;:\&quot;sub\&quot;}&quot;
      },
      {
        &quot;name&quot;: &quot;family_name&quot;,
        &quot;type&quot;: &quot;text&quot;,
        &quot;value&quot;: &quot;Mustermann&quot;
      },
      {
        &quot;name&quot;: &quot;Name&quot;,
        &quot;type&quot;: &quot;text&quot;,
        &quot;value&quot;: &quot;Max Mustermann&quot;
      },
      {
        &quot;name&quot;: &quot;Issuer&quot;,
        &quot;type&quot;: &quot;text&quot;,
        &quot;value&quot;: &quot;https://provider&quot;
      },
      {
        &quot;name&quot;: &quot;Gender&quot;,
        &quot;type&quot;: &quot;text&quot;,
        &quot;value&quot;: &quot;M&quot;
      },
      {
        &quot;name&quot;: &quot;preferred_username&quot;,
        &quot;type&quot;: &quot;text&quot;,
        &quot;value&quot;: &quot;mm&quot;
      },
      {
        &quot;name&quot;: &quot;updated_at&quot;,
        &quot;type&quot;: &quot;text&quot;,
        &quot;value&quot;: &quot;Wed Aug 31 09:06:43 UTC 2016&quot;
      },
      {
        &quot;name&quot;: &quot;given_name&quot;,
        &quot;type&quot;: &quot;text&quot;,
        &quot;value&quot;: &quot;Max&quot;
      },
      {
        &quot;name&quot;: &quot;Groups&quot;,
        &quot;type&quot;: &quot;textarea&quot;,
        &quot;value&quot;: &quot;[&lt;&lt;\&quot;Users\&quot;&gt;&gt;]&quot;
      },
      {
        &quot;name&quot;: &quot;Subject&quot;,
        &quot;type&quot;: &quot;text&quot;,
        &quot;value&quot;: &quot;sub&quot;
      }
    ],
    &quot;id&quot;: &quot;9b579b68-ba01-44fb-9f00-576a055e12b1&quot;
  },
  &quot;result&quot;: &quot;ok&quot;
}
</code></pre><p>each entry consists of:</p>
<ul>
<li><em>name</em>: the name of the value</li>
<li><em>type</em>: the datatype</li>
<li><em>value</em>: the actual value</li>
</ul>
<p>The meaning of these entries depend on the service/plugin being used.</p>
<h2 id="revoke-credential">Revoke Credential</h2>
<p>To revoke a <a href="GLOSSARY.html#credential" class="glossary-term" title="Any kind of information used to gain access to a service, such as e.g.
username/password for ssh">credential</a>, a DELETE request for that <a href="GLOSSARY.html#credential" class="glossary-term" title="Any kind of information used to gain access to a service, such as e.g.
username/password for ssh">credential</a> is needed. The path of a <a href="GLOSSARY.html#credential" class="glossary-term" title="Any kind of information used to gain access to a service, such as e.g.
username/password for ssh">credential</a> is
<code>/api/v2/&lt;provider id&gt;/credential/&lt;credential id&gt;</code>.
Authorization is needed for this request, please refer to <code>Authorization Header</code> for details.</p>
<p>A revocation of a <a href="GLOSSARY.html#credential" class="glossary-term" title="Any kind of information used to gain access to a service, such as e.g.
username/password for ssh">credential</a> might look like:</p>
<pre><code>DELETE /api/v2/iam/credential/qO10bfakPev2sbW5NWJuCdFKhzG4FmqV HTTP/1.1
Host: localhost
Accept: */*
Authorization: Bearer ya29.[...]MUchM
</code></pre><p>And the result would be a status response.</p>
<pre><code>{
  &quot;result&quot;: &quot;ok&quot;
}
</code></pre><h2 id="authorization-header">Authorization Header</h2>
<p>To get the request authorized, the <code>Authorization</code> header needs to be set.
Following the OAuth2.0 spec, the access token will be added into the authorization
header as a bearer token:</p>
<pre><code>Authorization: Bearer ya29.[...]uMUchM
</code></pre>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="developer.html" class="navigation navigation-prev " aria-label="Previous page: Developer Guide">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="service_ref_card.html" class="navigation navigation-next " aria-label="Next page: WaTTS - Service Reference Card">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"REST Api","level":"1.6","depth":1,"next":{"title":"WaTTS - Service Reference Card","level":"1.7","depth":1,"path":"service_ref_card.md","ref":"service_ref_card.md","articles":[]},"previous":{"title":"Developer Guide","level":"1.5","depth":1,"path":"developer.md","ref":"developer.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"root":"./gitbook","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"api.md","mtime":"2017-03-17T14:06:44.112Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-03-28T08:43:17.063Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

